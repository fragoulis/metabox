!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.metabox.defaults,n);this.$element=e(t);this.$content=e("."+this.options.cssClass+"-content",t);this.options.errorText=this.options.errorText.replace("{url}",this.options.url);if(this.options.loadingContainer)this.options.loadingContainer=e(this.options.loadingContainer);else this.options.loadingContainer=this.$content;if(this.options.refreshTimeout>0)this.createTimeout();else if(this.options.refreshInterval>0)this.createInterval();if(this.options.refreshOnInit)this.refresh()};t.prototype={constructor:t,createTimeout:function(){var e=this;setTimeout(function(){e.refresh()},this.options.refreshTimeout)},createInterval:function(){var e=this;setInterval(function(){e.refresh()},this.options.refreshInterval)},refresh:function(t){var n;if(t&&t.error!==undefined){n=t.error;delete t.error}var r=this;t=e.extend({type:this.options.type,url:this.options.url,data:this.options.data,beforeSend:function(){r.$element.addClass(r.options.loadingClass);r.options.loadingContainer.html(r.options.loadingText);r.options.beforeRefresh.apply(r)},success:function(e){r.$element.removeClass(r.options.loadingClass);r.options.loadingContainer.html("");r.options.handleResponse.apply(r,[e]);r.options.afterRefresh.apply(r,[e])},error:function(e,t,i){var s,o;r.$element.removeClass(r.options.loadingClass);r.options.loadingContainer.html(r.options.errorText);if(e.readyState===0||e.status===0){return}if(n!==undefined){s=n(e);if(s!==undefined&&!s){return}}switch(t){case"timeout":o="The request timed out!";break;case"parsererror":o="Parser error!";break;case"error":if(e.status&&!/^\s*$/.test(e.status)){o="Error "+e.status}else{o="Error"}if(e.responseText&&!/^\s*$/.test(e.responseText)){o=o+": "+e.responseText}break}if(o)alert(o)}},t||{});if(t.data!==undefined&&t.type==="GET"){t.url=e.param.querystring(t.url,t.data);t.data={}}e.ajax(t)}};e.fn.metabox=function(n,r){return this.each(function(){var i=e(this),s=i.data("metabox"),o=typeof n=="object"&&n;if(!s)i.data("metabox",s=new t(this,o));if(n=="refresh")s.refresh(r)})};e.fn.metabox.defaults={loadingText:"loading...",loadingClass:"metabox-loading",loadingContainer:null,errorText:"Error loading {url}",cssClass:"metabox",url:null,data:{},type:"GET",refreshOnInit:false,refreshTimeout:0,refreshInterval:0,beforeRefresh:function(){},handleResponse:function(e){this.$content.html(e)},afterRefresh:function(e){},debug:true};e.fn.metabox.Constructor=t}(window.jQuery)